(this["webpackJsonpdroste-creator"]=this["webpackJsonpdroste-creator"]||[]).push([[0],{32:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(1),o=n(7),c=n.n(o),i=n(3),s=n(5),l=n.n(s);function d(e){return[e[4]*e[8]-e[5]*e[7],e[2]*e[7]-e[1]*e[8],e[1]*e[5]-e[2]*e[4],e[5]*e[6]-e[3]*e[8],e[0]*e[8]-e[2]*e[6],e[2]*e[3]-e[0]*e[5],e[3]*e[7]-e[4]*e[6],e[1]*e[6]-e[0]*e[7],e[0]*e[4]-e[1]*e[3]]}function j(e,t){for(var n=Array(9),a=0;3!=a;++a)for(var r=0;3!=r;++r){for(var o=0,c=0;3!=c;++c)o+=e[3*a+c]*t[3*c+r];n[3*a+r]=o}return n}function h(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}function x(e,t,n,a,r,o,c,i){var s=[e,n,r,t,a,o,1,1,1],l=h(d(s),[c,i,1]);return j(s,[l[0],0,0,0,l[1],0,0,0,l[2]])}function b(e,t,n,a,r,o,c,i,s,l){var h=function(e,t,n,a,r,o,c,i,s,l,h,b,u,p,m,O){var f=x(e,t,r,o,s,l,u,p);return j(x(n,a,c,i,h,b,m,O),d(f))}(0,0,n,a,e,0,r,o,0,t,c,i,e,t,s,l);for(let d=0;9!=d;++d)h[d]=h[d]/h[8];return[h[0],h[3],0,h[6],h[1],h[4],0,h[7],0,0,1,0,h[2],h[5],0,h[8]]}n(32);function u({distance:e,angle:t}){return{x:e*Math.cos(t),y:e*Math.sin(t)}}function p({x:e,y:t}){return{distance:Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),angle:Math.atan2(t,e)}}window.GLOBAL_ANIMATION="OFF";const m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],O={OFF:"Off",IN:"In",OUT:"Out"};function f({label:e,value:t,options:n,onChange:o,disabled:c=!1}){const[s,l]=Object(r.useState)(!1),d=Object(r.useRef)();return((e,t)=>{const n=n=>{e.current&&!e.current.contains(n.target)&&t()};Object(r.useEffect)((()=>(document.addEventListener("click",n),()=>{document.removeEventListener("click",n)})))})(d,(()=>{l(!1)})),Object(a.jsxs)("div",{className:"dropdown ".concat(s?"":"-hide"," ").concat(c?"-disabled":""),ref:d,onClick:()=>{l(!c&&!s)},children:[Object(a.jsxs)(i.e,{className:"dropdown-header",children:[e," ",Object(a.jsx)("strong",{children:n[t]})]}),Object(a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:Object(a.jsx)("polyline",{points:"6 9 12 15 18 9"})}),Object(a.jsx)("div",{className:"dropdown-options",children:Object.keys(n).map((e=>Object(a.jsx)("div",{className:"dropdown-option",onClick:()=>{o(e),l(!1)},children:Object(a.jsx)(i.e,{children:n[e]})},e)))})]})}const g={Flor:{src:"flor.jpg",ratio:1,example:[.852,.001,1.1312,.6366,-.073,.28,.148,.999],deep:32},"Chichen Itza":{src:"chichenitza.svg",ratio:1,example:[.12,.05,.88,.05,.1,27/32,.9,27/32],deep:8},"Tokyo 1":{src:"tokyo1.jpg",ratio:3/4,example:[.15,.2,.85,.2,.15,.9,.85,.9],deep:32},"Tokyo 2":{src:"tokyo2.jpg",ratio:3/4,example:[.15,.2,.85,.2,.15,.9,.85,.9],deep:32},"Tokyo 3":{src:"tokyo3.jpg",ratio:3/4,example:[.15,.2,.85,.2,.15,.9,.85,.9],deep:32}};var y=function(){const[e,t]=Object(r.useState)(g[Object.keys(g)[Math.floor(Math.random()*Object.keys(g).length)]]),n=Math.min(window.innerHeight-64,window.innerWidth/e.ratio),o=n*e.ratio,c=n,[s,d]=Object(r.useState)(!1),[j,h]=Object(r.useState)("handleDrag"),[x,y]=Object(r.useState)(e.deep||32),w=window.innerWidth-o>300,v=!!w||s,[k,N]=Object(r.useState)("OFF"),[A,M]=Object(r.useState)([{x:o*e.example[0],y:c*e.example[1]},{x:o*e.example[2],y:c*e.example[3]},{x:o*e.example[4],y:c*e.example[5]},{x:o*e.example[6],y:c*e.example[7]}]);Object(r.useEffect)((()=>{const n=Math.min(window.innerHeight-64,window.innerWidth/e.ratio),a=n*e.ratio,r=n;t(e),y(e.deep||32),M([{x:a*e.example[0],y:r*e.example[1]},{x:a*e.example[2],y:r*e.example[3]},{x:a*e.example[4],y:r*e.example[5]},{x:a*e.example[6],y:r*e.example[7]}])}),[e]);const L={handleDrag:function({x:e,y:t},n){M((a=>{const r=[...a];return r[n]={x:e,y:t},r}))},handleDragMirror:function({x:e,y:t},n){M((a=>{const r=[...a];return r[n]={x:e,y:t},r[function(e){return 0===e?3:1===e?2:2===e?1:3===e?0:void 0}(n)]={x:o-e,y:c-t},r}))},handleDragLockAspect:function({x:e,y:t},n){M((a=>{const r=[...a];r[n]={x:e,y:t};const i=r[0],s=p({x:r[3].x-i.x,y:r[3].y-i.y}),l=p({x:o,y:0}),d=p({x:0,y:c}),j=p({x:o,y:c}),h=Math.sqrt(o*o+c*c),x=Math.sqrt(Math.pow(r[3].x-i.x,2)+Math.pow(r[3].y-i.y,2)),b={distance:x/h*o,angle:s.angle+l.angle-j.angle};r[1]={x:i.x+u(b).x,y:i.y+u(b).y};const m={distance:x/h*c,angle:s.angle+d.angle-j.angle};return r[2]={x:i.x+u(m).x,y:i.y+u(m).y},r}))}},F=b(o,c,A[0].x-0*o,A[0].y-0*c,A[1].x-0*o,A[1].y-0*c,A[2].x-0*o,A[2].y-0*c,A[3].x-0*o,A[3].y-0*c),D=function(e){const[t,n,a,r,o,c,i,s,l,d,j,h,x,b,u,p]=e,m=[[t,n,a,r],[o,c,i,s],[l,d,j,h],[x,b,u,p]];for(var O,f=m.length,g=[],y=0;y<f;y++)g[y]=[];for(y=0;y<f;y++)for(var w=0;w<f;w++)g[y][w]=0,y==w&&(g[y][w]=1);for(var v=0;v<f;v++){for(O=m[v][v],w=0;w<f;w++)m[v][w]/=O,g[v][w]/=O;for(y=v+1;y<f;y++)for(O=m[y][v],w=0;w<f;w++)m[y][w]-=m[v][w]*O,g[y][w]-=g[v][w]*O}for(v=f-1;v>0;v--)for(y=v-1;y>=0;y--)for(O=m[y][v],w=0;w<f;w++)m[y][w]-=m[v][w]*O,g[y][w]-=g[v][w]*O;for(y=0;y<f;y++)for(w=0;w<f;w++)m[y][w]=g[y][w];return m}(F).flat();function I(e){const[t,n,a,r,o,c,i,s,l,d,j,h,x,b,u,p]=e;return[t,o,x,n,c,b,r,s,p]}function C(e,t){const n=I(e),a=I(t);return[(r=function(e,t){for(var n=Array(9),a=0;3!=a;++a)for(var r=0;3!=r;++r){for(var o=0,c=0;3!=c;++c)o+=e[3*a+c]*t[3*c+r];n[3*a+r]=o}return n}(n,a))[0],r[3],0,r[6],r[1],r[4],0,r[7],0,0,1,0,r[2],r[5],0,r[8]];var r}const T=[m];for(let a=1;a<x;a++)T.push(C(T[a-1],F.flat()));return Object(r.useEffect)((()=>{window.GLOBAL_ANIMATION=k}),[k]),Object(r.useEffect)((()=>{const e=document.querySelector(".main-animatable");let t=0;!function n(){"OUT"===window.GLOBAL_ANIMATION?(t+=.012,t>1&&(t=0)):"IN"===window.GLOBAL_ANIMATION&&(t-=.012,t<0&&(t=1));const a=D.map(((e,n)=>e*t+m[n]*(1-t))),r="matrix3d(".concat(a.join(","),")");if(e.style.transform=r,console.log(window.GLOBAL_ANIMATION),"OFF"!==window.GLOBAL_ANIMATION)window.requestAnimationFrame(n);else{const t="matrix3d(".concat(m.join(","),")");e.style.transform=t}}()}),[D,k]),Object(a.jsxs)(r.Fragment,{children:[Object(a.jsxs)("div",{className:"main",onClick:()=>{d(!1)},children:[Object(a.jsx)(i.c,{accent:"#e74c3c"}),Object(a.jsx)("div",{className:"img image-container-cut",style:{height:c,width:o,overflow:"hidden"},children:Object(a.jsx)("div",{className:"main-animatable image-container -transformable",children:T.map(((t,n)=>Object(a.jsx)("img",{alt:"",className:"img -transformed -transformable",style:{width:o,height:c,transform:"matrix3d(".concat(t.join(","),")")},src:e.src},n+e.src)))})}),Object(a.jsx)(l.a,{defaultPosition:A[0],position:A[0],onDrag:(e,t)=>L[j](t,0),children:Object(a.jsx)("button",{style:{display:"OFF"===k?"block":"none"},className:"point",children:"0"})}),"handleDragLockAspect"!==j&&Object(a.jsx)(l.a,{defaultPosition:A[1],position:A[1],onDrag:(e,t)=>L[j](t,1),children:Object(a.jsx)("button",{style:{display:"OFF"===k?"block":"none"},className:"point",children:"1"})}),"handleDragLockAspect"!==j&&Object(a.jsx)(l.a,{defaultPosition:A[2],position:A[2],onDrag:(e,t)=>L[j](t,2),children:Object(a.jsx)("button",{style:{display:"OFF"===k?"block":"none"},className:"point",children:"2"})}),Object(a.jsx)(l.a,{defaultPosition:A[3],position:A[3],onDrag:(e,t)=>L[j](t,3),children:Object(a.jsx)("button",{style:{display:"OFF"===k?"block":"none"},className:"point",children:"3"})})]}),Object(a.jsxs)("div",{className:"sidebar ".concat(v?"":"-hide"),children:[Object(a.jsx)("div",{className:"sidebar-element",children:Object(a.jsx)(f,{label:"Controls",value:j,options:{handleDrag:"Free",handleDragMirror:"Mirror",handleDragLockAspect:"Aspect Lock"},onChange:h})}),Object(a.jsx)("div",{className:"sidebar-element",children:Object(a.jsx)(f,{label:"Depth",value:x,options:{8:8,16:16,32:32,72:72,128:128,256:"256 \u26a0\ufe0f"},onChange:e=>y(Number(e))})}),Object(a.jsx)("div",{className:"sidebar-element",children:Object(a.jsx)(f,{label:"Animation",value:k,options:O,onChange:N})}),Object(a.jsx)("hr",{}),Object(a.jsx)("div",{className:"sidebar-element",children:Object(a.jsx)(f,{label:"Load Example",value:null,options:Object.keys(g),onChange:e=>{const n=g[Object.keys(g)[e]];t(n)}})}),Object(a.jsx)("div",{className:"sidebar-element",children:Object(a.jsxs)(i.e,{children:["Droste Creator is a tool to create recursive images. Source"," ",Object(a.jsx)(i.a,{href:"https://github.com/javierbyte/droste-creator",children:"Github"}),". Code and pictures by ",Object(a.jsx)(i.a,{href:"https://javier.xyz",children:"javierbyte"}),"."]})}),!1]}),Object(a.jsxs)("div",{className:"topnav",children:[Object(a.jsxs)(i.e,{style:{flex:1,display:"flex",flexWrap:"wrap"},children:[Object(a.jsx)("div",{children:"Droste"}),Object(a.jsx)("strong",{children:"Creator"})]}),Object(a.jsx)("div",{style:{flex:1}}),Object(a.jsxs)("div",{className:"jb-file-uploader-container",children:[Object(a.jsx)(i.b,{children:"New Picture"}),Object(a.jsx)("input",{className:"jb-file-uploader",type:"file",onChange:function(e){e.stopPropagation(),e.preventDefault();const n=e.dataTransfer,a=(n?n.files:e.target.files)[0],r=new window.FileReader;r.onload=async e=>{const n=e.currentTarget.result,[a,r]=await async function(e,t=529984){return new Promise((n=>{let a=new Image;a.src=e,a.onload=()=>{let e=document.createElement("canvas");const r=a.width,o=a.height;let c=a.width,i=a.height;for(;c*i>t;)c/=Math.sqrt(2,2),i/=Math.sqrt(2,2);c=Math.round(c),i=Math.round(i),e.width=c,e.height=i,e.getContext("2d").drawImage(a,0,0,c,i),n([e.toDataURL(),{originalWidth:r,originalHeight:o}])}}))}(n);t({src:a,ratio:r.originalWidth/r.originalHeight,example:[.2,.2,.8,.2,.2,.8,.8,.8],deep:20})},r.readAsDataURL(a)},multiple:!0,accept:"image/*","aria-label":"Drop an image here, or click to select"})]}),Object(a.jsx)(i.d,{w:1}),!w&&Object(a.jsx)(i.b,{onClick:()=>{d(!s)},children:Object(a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[Object(a.jsx)("circle",{cx:"12",cy:"12",r:"3"}),Object(a.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]})]},e.src)};c.a.render(Object(a.jsx)(y,{}),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.2994d87a.chunk.js.map